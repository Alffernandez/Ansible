---
# For possible options see https://docs.ansible.com/ansible/latest/collections/awx/awx/job_template_module.html#ansible-collections-awx-awx-job-template-module
ansible_tower_config:
  default:
    job_templates:
      SCHRODERS_INTERNAL_autopatch_manual: &template-SCHRODERS_INTERNAL_autopatch_manual
        description: Autopatch manual
        concurrent_jobs_enabled: True 
        credentials:
          - MACHINE_z_unixadm_prd
          - VAULT_unix_ansible_vault
        ask_extra_vars: True
        extra_vars:
          reboot: True
          clustered_group: False
          SERIAL: 20
        ask_limit: True 
        playbook: playbooks/awx_patch_servers.yml
        become_enabled: True    
      SCHRODERS_INTERNAL_schroders_compute_v2:  &template-SCHRODERS_INTERNAL_schroders_compute_v2
        description: Backend for Schroders Compute v2
        inventory: UNIX_ansible_unix_inventory
        credentials:
          - MACHINE_z_unixadm_prd 
          - VAULT_schroders_compute_v2
          - UNIX_DOCKER_jfa
        forks: 10
        ask_extra_vars: True # This is required for the API to accept extra_vars
        concurrent_jobs_enabled: True 
        limit: ansible-vip
        project: SCHRODERS_INTERNAL_sdrcompute_terraform
        playbook: deploy_sc_v2.yml    
      SCHRODERS_INTERNAL_ansible_unix: &template-SCHRODERS_INTERNAL_ansible_unix
        description: Main configuration management UNIX playbook for SCv2
        ask_limit: True
        ask_credential: True  
        ask_inventory: True 
        credentials: 
          - VAULT_unix_ansible_vault
        concurrent_jobs_enabled: True 
        project: SCHRODERS_INTERNAL_ansible_unix
        playbook: unix.yml        
      SCHRODERS_INTERNAL_maintenance_window_setup: &template-SCHRODERS_INTERNAL_maintenance_window_setup
        description: Sets up device maintenance windows in LM/MS/BMC / API calls only
        inventory: UNIX_ansible_unix_inventory
        credentials: 
          - MACHINE_z_unixadm_prd
          - VAULT_unix_ansible_vault
        project: SCHRODERS_INTERNAL_ansible_unix
        playbook: playbooks/manage_maintenance_windows.yml
        become_enabled: False
        concurrent_jobs_enabled: True 
        ask_extra_vars: True
        extra_vars:
          maintenance_window_action: create      
      SCHRODERS_INTERNAL_unix_local_scripts: &template-SCHRODERS_INTERNAL_local_scripts
        description: UNIX local scripts
        ask_limit: True
        limit: poc 
        credentials: 
          - MACHINE_z_unixadm_prd
          - VAULT_unix_ansible_vault
        playbook: local-scripts.yml          
  prd:
    job_templates:
      SCHRODERS_INTERNAL_maintenance_window_setup:  
        <<: *template-SCHRODERS_INTERNAL_maintenance_window_setup    
      SCHRODERS_INTERNAL_ansible_unix:
        <<: *template-SCHRODERS_INTERNAL_ansible_unix
        inventory: UNIX_ansible_unix_inventory        
      SCHRODERS_INTERNAL_schroders_compute_v2:
        <<: *template-SCHRODERS_INTERNAL_schroders_compute_v2
        notification_templates_error:
          - SCHRODERS_Splunk
        notification_templates_success:
          - SCHRODERS_Splunk        
        extra_vars:
          TF_VAR_INP_PAR_ENVIRONMENT_BRANCH: production
          TF_VAR_ENVIRONMENT_BRANCH: production        
  dev:
    job_templates:
      SCHRODERS_INTERNAL_maintenance_window_setup:  
        <<: *template-SCHRODERS_INTERNAL_maintenance_window_setup   
      SCHRODERS_INTERNAL_autopatch_manual: # This is a based on the Snow Dev CMDB only
        <<: *template-SCHRODERS_INTERNAL_autopatch_manual
        project: SCHRODERS_INTERNAL_ansible_unix
        inventory: SCHRODERS_INTERNAL_ansible_unix_inventory_dev
      SCHRODERS_INTERNAL_unix_local_scripts:
        <<: *template-SCHRODERS_INTERNAL_local_scripts
        project: SCHRODERS_INTERNAL_unix_local_scripts
        inventory: SCHRODERS_INTERNAL_ansible_unix_inventory_dev
      SCHRODERS_INTERNAL_ansible_unix:
        <<: *template-SCHRODERS_INTERNAL_ansible_unix
        inventory: SCHRODERS_INTERNAL_ansible_unix_inventory_dev # SCv2 in Ansible dev uses a CMDB only based inventory from the dev instance of Snow         
      SCHRODERS_INTERNAL_schroders_compute_v2:  
        <<: *template-SCHRODERS_INTERNAL_schroders_compute_v2
        notification_templates_error:
          - SCHRODERS_Splunk
        notification_templates_success:
          - SCHRODERS_Splunk            
        extra_vars:
          TF_VAR_INP_PAR_ENVIRONMENT_BRANCH: development
          TF_VAR_ENVIRONMENT_BRANCH: development